# 计算机开机启动流程

> BIOS存放在ROM（芯片）中，由COSM电池供电。

## 启动流程

1. 通电，CPU的CS:IP寄存器被强制初始化为0xFFFF0（这里是一条jmp指令）

   > 参考《实模式下的内存分布》，0XF0000 - 0XFFFFF会映射到rom。

2. CPU从0xFFFF0开始执行（即开始执行bios程序）

3. BIOS程序会先检测内存和显卡等外设，即俗称的开机自检

4. BIOS在内存中 0x000～0x3FF 处建立数据结构，中断向量表 IVT 并填写中断例程  

5. BIOS程序校验0盘0道1扇区是否是MBR（是否0x55aa结尾）

6. BIOS加载MBR到0x7c00以后的512字节的内存区域

7. 通过`jmp 0:0x7c00`  指令跳转到0x7c00开始执行Loader

   > 这是一个直接远跳转指令，CS被替换为0，IP被替换为0x7c00

8. Loader加载内核到内存

   Loader会根据ELF的Program Header Table将内核中的段加载到合适的内存区域

9. 跳入保护模式

   1. 禁用PIC中断（此时中断机制还不可用）
   2. 开启A20Gate
   3. 初始化GDT
   4. 置CR0寄存器保护模式位，CR0是一个32位寄存器，其中第一位是标志CPU保护模式的FLAG）
   5. 跳入保护模式

10. 内核正式开始运行

